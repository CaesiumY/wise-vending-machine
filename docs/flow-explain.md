# 예외 케이스

## 현금 결제 플로우
### 흐름 요약
1. 현금 결제 선택
2. 현금 투입 확인
3. 금액에 따른 음료 버튼 활성화
4. 음료 선택
5. 결제 완료
6. 잔액 반환

### 투입 화폐 반환
자판기에서 현금을 넣을 때 특히 지폐의 경우 인식 실패로 반환하는 경우가 있습니다. 해당 상황을 예외 케이스로 추가하였습니다.

### 반환 버튼
자판기에 금액이 남아있을 경우에 반환 버튼을 누를 수 있도록 하였습니다. 추가로 돈이 있는 상태로 타임 아웃될 경우 자동으로 반환이 진행됩니다.

### 잔돈 부족 안내
어쩌다가 잔돈 화폐의 수가 부족할 때가 있을 수 있습니다. 예를 들어 10000원을 투입하고 600원 물을 선택하면 9400원을 거슬러줘야하죠. 하지만 이 상황에서 1000원 지폐가 부족하다면 온전히 거슬러 줄 수 없게 됩니다. 이러한 예외 케이스입니다.



## 카드 결제 플로우

### 흐름 요약
1. 카드 결제 선택
2. 음료 선택(1개씩)
3. 카드 결제
### 주문 당 결제 이유
처음 생각한 부분은 키오스크처럼 여러 수량을 장바구니에 담아 한 번에 카드로 결제하는 시스템이었습니다. 그러나 이는 자판기에 디스플레이 액정이 있어야만 가능한 시스템이라고 판단했습니다.
왜냐하면 현실의 상황을 가정했을 때 버튼을 실수로 2번 누르는 등의 알 수 없는 예외 상황이 일어나기 마련입니다. 그 상황에서 내가 얼마나 장바구니에 담았는지 모르는 상태로 결제를 하게 된다면 사용자가 원치 않은 주문이 진행될 수도 있는 리스크를 가지게 됩니다. 
따라서 사용자의 결제 보증과 추가적인 컴플레인 이슈를 막기 위해 주문 당 한 번의 카드 결제를 선택하게 되었습니다.

### 취소 / 타임아웃
음료 선택 시에 잔여 음료가 1개도 없는 경우가 있을 수 있습니다. 이럴 경우를 대비해 취소 버튼을 추가합니다. 그리고 잔여 음료가 없으니 그냥 발걸음을 옮기는 사용자를 대비해 타임 아웃도 추가합니다.
그리고 카드 결제는 타임 아웃이 있어야 한다고 생각합니다. 언제까지고 결제 대기 상태로 있을 수는 없으니 말입니다. 물론 마음이 바뀌거나 선택된 메뉴를 바꾸려고 취소하는 경우도 추가해야 합니다.

### 카드 인식/결제 실패
현실에서의 카드 결제를 생각해보면 내부적으로 많은 검증이 있겠지만 사용자가 경험하는 것은 다음 두 가지라고 생각합니다. 카드의 인식 실패와 결제 실패입니다. 인식 실패는 말 그대로 카드의 손상이나 인식 타이밍 등에 의한 실패이고, 결제 실패는 카드의 잔액 문제 등으로 인한 실패 케이스입니다.

### 잔액 확인
잔액을 확인하여 0원일 경우에는 거래 완료로 생각하여 대기로 돌아갑니다. 그렇지 않고 0원 초과 금액이 나왔을 시에는 다시 거래 진행 상황으로 돌아갑니다.

## 공통
### 현금/카드 결제 취소 선택
현금으로 결제하려다가 맘이 바뀌어 카드로 결제하거나 그 반대의 상황에서의 취소를 통해 초기 대기 상태로 돌아가는 것을 의미합니다.

### 배출 실패 / 결제 취소 및 재고 복구
자판기가 돈을 먹었다... 라는 말을 들어보신 적 있으실 겁니다. 이 부분은 희망 사항이기도 합니다. 배출에 실패했다는 것을 감지하여 기존 결제를 취소하고 감소된 잔여 재고를 복구합니다. 결제가 끝난 상태이기 때문에 이후에는 다시 대기 상태로 돌아갑니다.
